# RabbitMQ Documentation Synchronization

This rule ensures that `VERSION_COMPATIBILITY.md` and `DISCOVERY_SUMMARY.md` stay synchronized.

## File Roles

- **`VERSION_COMPATIBILITY.md`**: Reference guide documenting field availability across RabbitMQ versions (3.0-4.2+). This is the **authoritative reference** for developers.
- **`DISCOVERY_SUMMARY.md`**: Test report documenting actual discovery runs and findings. This is a **historical record** of what was tested and discovered.

## Synchronization Rule

**After running discovery scripts or finding new field differences:**

1. **Update `DISCOVERY_SUMMARY.md`** with:
   - New fields discovered
   - Version-specific findings
   - Actions taken (fields added to types)
   - Test results and notes

2. **Then update `VERSION_COMPATIBILITY.md`** to reflect the new findings:
   - Add new fields to the appropriate version tables
   - Update breaking changes sections
   - Add new version sections if needed
   - Document conditional fields if discovered
   - Update field availability matrices

## What to Sync

When new findings are documented in `DISCOVERY_SUMMARY.md`, ensure `VERSION_COMPATIBILITY.md` includes:

- ✅ New fields in the field availability tables
- ✅ Correct version ranges (when introduced/removed)
- ✅ Breaking changes documented
- ✅ Conditional fields documented
- ✅ Version-specific notes

## Example Workflow

1. Run discovery script: `npx tsx scripts/rabbitmq/discover-rabbitmq-fields.ts ...`
2. Review findings and update types if needed
3. Update `DISCOVERY_SUMMARY.md` with findings
4. **Sync to `VERSION_COMPATIBILITY.md`**:
   - Add new fields to tables
   - Update version columns
   - Add breaking change notes
   - Document conditional behavior

## Field Availability Table Format

When adding fields to `VERSION_COMPATIBILITY.md`, use this format:

- `3.0-3.7` - Legacy versions
- `3.8-3.11` - Supported versions
- `3.12` - LTS version (may need separate column)
- `3.13+` - LTS with new features
- `4.0-4.1` - Current major version
- `4.2+` - Latest version

Use ✅ for available, ❌ for not available.

## Breaking Changes

Always document breaking changes in the "Breaking Changes" section with:
- Version when change occurred
- Fields affected
- Migration notes
- Alternatives (if applicable)

## Conditional Fields

If fields are discovered to be conditional (only appear under certain circumstances), document them in:
- The "Conditional Fields" section
- Field availability tables (with notes)
- Type definitions (already marked as optional)

## When to Update

Update `VERSION_COMPATIBILITY.md` when:
- New RabbitMQ versions are tested
- New fields are discovered via discovery script
- Breaking changes are found
- Conditional field behavior is identified
- After reviewing `DISCOVERY_SUMMARY.md` for new findings

## Files Location

- `src/core/rabbitmq/VERSION_COMPATIBILITY.md` - Reference guide
- `src/core/rabbitmq/DISCOVERY_SUMMARY.md` - Discovery report
- `src/core/rabbitmq/discovery/` - Generated reports (gitignored)
